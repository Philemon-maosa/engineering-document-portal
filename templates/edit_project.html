{% extends "base.html" %}

{% block content %}
<div class="container mt-4">

    <h2>Edit Project</h2>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ 'success' if category=='success' else 'danger' }} alert-dismissible fade show" role="alert">
              {{ message }}
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <!-- Update Project Form -->
    <form method="POST" action="{{ url_for('edit_project', project_id=project.id) }}">
        <div class="mb-3">
            <label for="projectName" class="form-label">Project Name</label>
            <input type="text" id="projectName" name="name" value="{{ project.name }}" class="form-control" required>
        </div>

        <div class="mb-3">
            <label for="projectDesc" class="form-label">Description</label>
            <textarea id="projectDesc" name="description" class="form-control" rows="4">{{ project.description }}</textarea>
        </div>

        {% if session.get("role") == "admin" %}
        <div class="mb-3">
            <label for="projectUsers" class="form-label">Assign Users to Project</label>
            <select id="projectUsers" name="users" class="form-select" multiple size="6">
                {% for user in all_users %}
                    <option value="{{ user.id }}" {% if user.id in assigned_user_ids %}selected{% endif %}>
                        {{ user.username }} ({{ user.role }})
                    </option>
                {% endfor %}
            </select>
            <div class="form-text">
                Hold Ctrl (Windows) or Cmd (Mac) to select multiple users.
            </div>
        </div>
        {% endif %}

        <div class="mt-3">
            <button type="submit" class="btn btn-success">Update Project</button>
            <a href="{{ url_for('projects') }}" class="btn btn-secondary ms-2">Back to Projects</a>
        </div>
    </form>

    {% if session.get("role") == "admin" %}
    <!-- Delete Project Form -->
    <form action="{{ url_for('delete_project', project_id=project.id) }}" method="POST" class="mt-4">
        <button type="submit" class="btn btn-danger"
                onclick="return confirm('Are you sure you want to delete this project?');">
            Delete Project
        </button>
    </form>
    {% endif %}

</div>
{% endblock %}
